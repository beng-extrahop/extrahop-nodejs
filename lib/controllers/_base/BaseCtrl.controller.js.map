{"version":3,"sources":["../../../src/controllers/_base/BaseCtrl.controller.js"],"names":["Utils","require","Config","Icons","moment","module","exports","appliance","utils","csvPath","DATA_DIR","CSV_DIR","join","dbPath","DB_DIR","config","JSON","stringify","format","options","console","info","toString","method","type","count","Success","host","Info","Warn","message","Error","results","params","Object","keys","key","filter","result","data","subkey","parseData","forEach","includes","tz","value","Array","length","assign","suppress","success","printError","printSuccess","printWarning"],"mappings":"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","file":"BaseCtrl.controller.js","sourcesContent":["// BaseCtrl.controller.js\n\nconst Utils = require('../../utils/BaseUtil.util.js');\nconst { Config, Icons } = require('../../constants/Global.constants');\n\nconst moment = require('moment-timezone');\n\nmodule.exports = class BaseCtrl {\n  constructor(appliance) {\n    this.appliance = appliance;\n    this.utils = Utils;\n    this.csvPath = [Config.DATA_DIR, Config.CSV_DIR].join('/');\n    this.dbPath = [Config.DATA_DIR, Config.DB_DIR].join('/');\n  }\n\n  toString(config = {}) {\n    return JSON.stringify(this, null, (config.format ? 2 : null));\n  }\n\n  print(options = {}) {\n    console.info(this.toString(options));\n  }\n\n  printSuccess(method, type, count) {\n    if (method === 'GET') {\n      console.info(`${Icons.Success} Retrieved ${count} ${type} from ${this.appliance.host}`);\n    }\n    else if (method === 'POST') {\n      console.info(`${Icons.Success} Posted ${count} ${type} to ${this.appliance.host}`);\n    }\n    else if (method === 'PATCH') {\n      console.info(`${Icons.Info} Modified ${type} on ${this.appliance.host}`);\n    }\n    else if (method === 'PATCH') {\n      console.info(`${Icons.Info} Updated ${type} on ${this.appliance.host}`);\n    }\n    else if (method === 'DELETE') {\n      console.info(`${Icons.Warn} Deleted ${type} from ${this.appliance.host}`);\n    }\n  }\n\n  printError(method, type, message) {\n    if ( message ) {\n      console.info(`${Icons.Error} Error: ${message} to ${method} ${type}`);\n    }\n    else if (method === 'GET') {\n      console.info(`${Icons.Error} Error retrieving ${type} from ${this.appliance.host}`);\n    }\n    else if (method === 'POST') {\n      console.info(`${Icons.Error} Error posting ${type} to ${this.appliance.host}`);\n    }\n    else if (method === 'PATCH') {\n      console.info(`${Icons.Error} Error modifying ${type} on ${this.appliance.host}`);\n    }\n    else if (method === 'PATCH') {\n      console.info(`${Icons.Error} Error updating ${type} on ${this.appliance.host}`);\n    }\n    else if (method === 'DELETE') {\n      console.info(`${Icons.Error} Error deleting ${type} from ${this.appliance.host}`);\n    }\n  }\n\n  printWarning(method, type) {\n    if (method === 'GET') {\n      console.info(`${Icons.Warn} Warning: retrieving ${type} from ${this.appliance.host}`);\n    }\n    else if (method === 'POST') {\n      console.info(`${Icons.Warn} Warning: posting ${type} to ${this.appliance.host}`);\n    }\n    else if (method === 'PATCH') {\n      console.info(`${Icons.Warn} Warning: modifying ${type} on ${this.appliance.host}`);\n    }\n    else if (method === 'PATCH') {\n      console.info(`${Icons.Warn} Warning: updating ${type} on ${this.appliance.host}`);\n    }\n    else if (method === 'DELETE') {\n      console.info(`${Icons.Warn} Warning: deleting ${type} from ${this.appliance.host}`);\n    }\n  }\n\n  // -------------------------------------\n  // Utility Functions\n  // -------------------------------------\n\n  filter(results = [], params = {}) {\n    const [key] = Object.keys(params);\n    return results.filter(result => result[key] === params[key]);\n  }\n\n  parse(data = {}, subkey) {\n    const parseData = data[subkey] || data;\n\n    Object.keys(parseData).forEach(key => {\n      if (key.includes('timestamp')) {\n        parseData[`${key}_fmt`] = moment(parseData[key]).tz('America/New_York').format('YYYY-MM-DD HH:mm:ss');\n      }\n\n      if (parseData[key] instanceof Object) {\n        parseData[key] = parseData[key].value;\n      }\n\n      if (parseData[key] instanceof Array) {\n        parseData[key] = parseData[key].length === 1 ? parseData[key][0] : parseData[key].join(',');\n      }\n    });\n\n    // Object.keys(parseData).forEach(key => {\n    //   if ( key === 'server' || key === 'client' ) {\n    //     const discoveryId = parseData[key];\n\n    //     if ( cache.some(item => item.startsWith(discoveryId)) ) {\n    //       parseData[key] = cache.find(item => item.startsWith(discoveryId)).split(':')[1];\n    //       console.log('Found server in cache:', discoveryId, parseData[key])\n    //       return;\n    //     }\n\n    //     const getDevice = this.appliance.getDevices('discovery_id', discoveryId, 1);\n\n    //     if ( getDevice.success ) {\n    //       const deviceName = getDevice.data[0].display_name;\n    //       console.log('Adding discovery ID to cache:', discoveryId, deviceName)\n\n    //       cache.push(`${discoveryId}:${deviceName}`);\n    //       parseData[key] = deviceName;\n    //     }\n    //   }\n    // });\n\n    return Object.assign(data, subkey ? { [subkey]: parseData } : parseData);\n  }\n\n  process(results = {}, type, options = {}) {\n    if (options.suppress) {\n      return results.data;\n    }\n\n    let data = results.data;\n    const { method, success } = results;\n    const count = data.length;\n\n    if (['PATCH', 'PUT', 'DELETE'].includes(method)) {\n      if (!success) {\n        this.printError(method, type);\n      }\n      else {\n        this.printSuccess(method, type);\n      }\n    }\n    else if (['GET', 'POST'].includes(method)) {\n      if (!success) {\n        this.printSuccess(method, type, count);\n        return results.data;\n      }\n\n      data = options.subkey ? results.data[options.subkey] : results.data;\n\n      if ((data || []).length === 0) {\n        this.printWarning(method, type);\n      }\n      else {\n        this.printSuccess(method, type, count);\n      }\n\n      return results.data;\n    }\n\n    return null;\n  }\n};\n"]}